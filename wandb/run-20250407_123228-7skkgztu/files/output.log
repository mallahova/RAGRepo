Evaluating Recall@10:   3%|██▏                                                                      | 1/34 [00:01<00:48,  1.47s/it]
Traceback (most recent call last):
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher/../../debugpy/__main__.py", line 71, in <module>
    cli.main()
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher/../../debugpy/../debugpy/server/cli.py", line 501, in main
    run()
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher/../../debugpy/../debugpy/server/cli.py", line 351, in run_file
    runpy.run_path(target, run_name="__main__")
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_runpy.py", line 310, in run_path
    return _run_module_code(code, init_globals, run_name, pkg_name=pkg_name, script_name=fname)
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_runpy.py", line 127, in _run_module_code
    _run_code(code, mod_globals, init_globals, mod_name, mod_spec, pkg_name, script_name)
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_runpy.py", line 118, in _run_code
    exec(code, run_globals)
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/run_experiments.py", line 259, in <module>
    main()
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/run_experiments.py", line 238, in main
    phase1_results = parameter_search(
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/run_experiments.py", line 132, in parameter_search
    final_recall, average_latency = evaluate_recall_and_latency(
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/evaluate_retrieval.py", line 50, in evaluate_recall_and_latency
    results = retrieval_chain.invoke(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/base.py", line 4780, in invoke
    return self._call_with_config(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/base.py", line 1933, in _call_with_config
    context.run(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/config.py", line 428, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/base.py", line 4633, in _invoke
    output = call_func_with_variable_args(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/config.py", line 428, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/retrieval/search_index.py", line 46, in retrieve_hybrid_top_k
    docs = hybrid_retriever.invoke(query)[:top_k_val]
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain/retrievers/ensemble.py", line 115, in invoke
    result = self.rank_fusion(input, run_manager=run_manager, config=config)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain/retrievers/ensemble.py", line 222, in rank_fusion
    retriever_docs = [
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain/retrievers/ensemble.py", line 223, in <listcomp>
    retriever.invoke(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/retrievers.py", line 259, in invoke
    result = self._get_relevant_documents(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/vectorstores/base.py", line 1077, in _get_relevant_documents
    docs = self.vectorstore.similarity_search(query, **_kwargs)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_community/vectorstores/faiss.py", line 643, in similarity_search
    docs_and_scores = self.similarity_search_with_score(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_community/vectorstores/faiss.py", line 515, in similarity_search_with_score
    embedding = self._embed_query(query)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_community/vectorstores/faiss.py", line 266, in _embed_query
    return self.embedding_function.embed_query(text)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_openai/embeddings/base.py", line 629, in embed_query
    return self.embed_documents([text])[0]
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_openai/embeddings/base.py", line 588, in embed_documents
    return self._get_len_safe_embeddings(texts, engine=engine)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_openai/embeddings/base.py", line 483, in _get_len_safe_embeddings
    response = self.client.create(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/resources/embeddings.py", line 128, in create
    return self._post(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/_base_client.py", line 919, in request
    return self._request(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/_base_client.py", line 955, in _request
    response = self._client.send(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 103, in handle_request
    return self._connection.handle_request(request)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 136, in handle_request
    raise exc
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 106, in handle_request
    ) = self._receive_response_headers(**kwargs)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 177, in _receive_response_headers
    event = self._receive_event(timeout=timeout)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 217, in _receive_event
    data = self._network_stream.read(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_backends/sync.py", line 128, in read
    return self._sock.recv(max_bytes)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/ssl.py", line 1292, in recv
    return self.read(buflen)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/ssl.py", line 1165, in read
    return self._sslobj.read(len)
KeyboardInterrupt
Traceback (most recent call last):
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher/../../debugpy/__main__.py", line 71, in <module>
    cli.main()
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher/../../debugpy/../debugpy/server/cli.py", line 501, in main
    run()
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher/../../debugpy/../debugpy/server/cli.py", line 351, in run_file
    runpy.run_path(target, run_name="__main__")
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_runpy.py", line 310, in run_path
    return _run_module_code(code, init_globals, run_name, pkg_name=pkg_name, script_name=fname)
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_runpy.py", line 127, in _run_module_code
    _run_code(code, mod_globals, init_globals, mod_name, mod_spec, pkg_name, script_name)
  File "/home/mallahova/.vscode/extensions/ms-python.debugpy-2025.6.0-linux-x64/bundled/libs/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_runpy.py", line 118, in _run_code
    exec(code, run_globals)
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/run_experiments.py", line 259, in <module>
    main()
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/run_experiments.py", line 238, in main
    phase1_results = parameter_search(
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/run_experiments.py", line 132, in parameter_search
    final_recall, average_latency = evaluate_recall_and_latency(
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/eval/evaluate_retrieval.py", line 50, in evaluate_recall_and_latency
    results = retrieval_chain.invoke(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/base.py", line 4780, in invoke
    return self._call_with_config(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/base.py", line 1933, in _call_with_config
    context.run(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/config.py", line 428, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/base.py", line 4633, in _invoke
    output = call_func_with_variable_args(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/runnables/config.py", line 428, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
  File "/home/mallahova/code/basics/projects/interview/RAGRepo/src/retrieval/search_index.py", line 46, in retrieve_hybrid_top_k
    docs = hybrid_retriever.invoke(query)[:top_k_val]
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain/retrievers/ensemble.py", line 115, in invoke
    result = self.rank_fusion(input, run_manager=run_manager, config=config)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain/retrievers/ensemble.py", line 222, in rank_fusion
    retriever_docs = [
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain/retrievers/ensemble.py", line 223, in <listcomp>
    retriever.invoke(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/retrievers.py", line 259, in invoke
    result = self._get_relevant_documents(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_core/vectorstores/base.py", line 1077, in _get_relevant_documents
    docs = self.vectorstore.similarity_search(query, **_kwargs)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_community/vectorstores/faiss.py", line 643, in similarity_search
    docs_and_scores = self.similarity_search_with_score(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_community/vectorstores/faiss.py", line 515, in similarity_search_with_score
    embedding = self._embed_query(query)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_community/vectorstores/faiss.py", line 266, in _embed_query
    return self.embedding_function.embed_query(text)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_openai/embeddings/base.py", line 629, in embed_query
    return self.embed_documents([text])[0]
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_openai/embeddings/base.py", line 588, in embed_documents
    return self._get_len_safe_embeddings(texts, engine=engine)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/langchain_openai/embeddings/base.py", line 483, in _get_len_safe_embeddings
    response = self.client.create(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/resources/embeddings.py", line 128, in create
    return self._post(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/_base_client.py", line 919, in request
    return self._request(
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/site-packages/openai/_base_client.py", line 955, in _request
    response = self._client.send(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 103, in handle_request
    return self._connection.handle_request(request)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 136, in handle_request
    raise exc
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 106, in handle_request
    ) = self._receive_response_headers(**kwargs)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 177, in _receive_response_headers
    event = self._receive_event(timeout=timeout)
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_sync/http11.py", line 217, in _receive_event
    data = self._network_stream.read(
  File "/home/mallahova/.local/lib/python3.10/site-packages/httpcore/_backends/sync.py", line 128, in read
    return self._sock.recv(max_bytes)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/ssl.py", line 1292, in recv
    return self.read(buflen)
  File "/home/mallahova/miniconda3/envs/ragrepo/lib/python3.10/ssl.py", line 1165, in read
    return self._sslobj.read(len)
KeyboardInterrupt
